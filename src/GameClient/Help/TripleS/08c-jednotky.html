<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html>
<head>
<title>TripleS - jednotky</title>
<link rel="StyleSheet" href="../obecny.css" type="text/css" />
<link rel="StyleSheet" href="../pisek.css" type="text/css" />
<meta http-equiv="Content-Type" content="text/html; charset=windows-1250" />
<style type="text/css">
</style>
</head>
<body>

<p class="odkaz">
<a href="08b-jednotky.html"><img class="sipka" src="../cast-predchozi.png" alt="Pøedchozí èást" /></a>
<a href="08b-jednotky.html#zpravy">Zprávy</a>
</a>
</p>

<h2 id="fronty">Fronty pøíkazù a notifikací</h2>

<p>Již jsme ukázali, jak se definují reakce na zprávy, upøesnili jsme význam notifikací a pøíkazù. Zbývá ukázat, jakým zpùsobem probíhá spouštìní reakcí na zprávy.</p>

<p>V každém okamžiku je interpretována nejvýše jedna reakce na notifikaci a nejvýše jedna reakce na pøíkaz u každé jednotky. Novì pøíchozí notifikace a pøíkazy se pøidávají do front.</p>

<h3 id="notifikace">Notifikace</h3>

<p>Reakce na notifikaci by mìla být pokud možno krátká a rychlá a podle potøeby iniciovat nìjakou èinnost pomocí poslání pøíkazù sám sobì nebo svým podøízeným. To proto, aby se co nejrychleji mohla zaèít interpretovat reakce na další notifikace èekající ve frontì.</p>

<p>V reakci na notifikaci je tedy velmi nevhodné provádìt nìjaké dlouho trvající akce, jako napøíklad nechat jednotku nìkam jít, nìkde útoèit, stavìt, tìžit, atp. Namísto toho by si jednotka mìla poslat pøíkaz na provedení této akce. Frontu pøíkazù lze explicitnì vyprázdnit, když potøebujeme, aby se pøíkaz zaèal provádìt ihned.</p>

<h3 id="prikazy">Fronty pøíkazù</h3>

<p>Každá jednotka si udržuje dvì fronty pøíkazù. V jedné frontì si udržuje pøíkazy od velitele, to je tzv. <b>nadøazená fronta</b>, a v druhé si udržuje pøíkazy, které si poslala sama sobì, to je tzv. <b>podøízená fronta</b>.</p>

<p>Pøíkazy od velitele vìtšinou znamenají nìjakou dlouhodobìjší èinnost, kdežto podøízená fronta obsahuje pøíkazy, které jsou typicky vlastní rozhodnutí jednotky na základì aktuální situace (podle notifikací).</p>

<p>Pøi vykonávání pøíkazù má pøednost podøízená fronta. Když je podøízená fronta pøíkazù prázdná (všechny pøíkazy jsou buï splnìny nebo byla fronta zámìrnì vyprázdnìna), zaènou se provádìt pøíkazy z nadøazené fronty. Když pøi provádìní pøíkazu z nadøazené fronty pøijde nìjaký pøíkaz do podøízené fronty, vykonávaná èinnost se pøeruší a zaène se provádìt pøíkaz z podøízené fronty, a po jejím dokonèení se pùvodní èinnost (pùvodní pøíkaz od velitele) restartuje.</p>

<p>Z chování front pøíkazù se mùže zdát, že byly jejich názvy zvoleny opaènì. Názvy byly zvoleny podle toho, že do nadøízené fronty pøicházejí pøíkazy od velitele (nadøízeného), a pouze velitel (nebo jiná nadøízená jednotka) dané jednotky mùže tuto frontu také vyprázdnit. Do podøízené fronty naopak pøicházejí pøíkazy od jednotky samotné, tedy to jsou vlastní rozhodnutí, ke kterým jednotka dospìla na základì aktuální situace (z notifikací), a jen ona sama si ji mùže vyprázdnit.</p>

<p>Fronty pøíkazù jednotky se vyprazdòují metodou <code>EmptyCommandQueue()</code>. Zda se vyprázdní nadøazená nebo podøízená fronta se rozhoduje za bìhu podle toho, zda metodu volá nadøazená jednotka nebo jednotka sama.</p>

<h3 id="priklad">Pøíklad</h3>

<p>Mechanismus front ilustrujeme na následujícím pøíkladì. Jednotka <b>A</b> dostane od svého velitele za úkol nìkam jít (napø. pøíkaz <code>GO</code>) a nìco tam udìlat (<code>DO_SOMETHING</code>). Pøi vykonávání pøíkazu <code>GO</code> od velitele tedy jednotka <b>A</b> nìkam jde, ale najednou na ni zaène útoèit nepøátelská jednotka (dostane notifikaci od serveru). Jednotka <b>A</b> se v reakci na notifikaci sama rozhodne útok opìtovat (pošle sama sobì pøíkaz <code>ATTACK</code>) a zároveò mùže poslat notifikaci svému veliteli, že je pod útokem. Pokud se velitel rozhodne s tím nìco dìlat (tøeba proto, že je více jednotek v dané oblasti pod útokem), mùže zrušit zadaný úkol jednotky <b>A</b> &bdquo;jdi nìkam a udìlej nìco&ldquo; tím, že jí vyprázdní nadøazenou frontu, pøípadnì zruší úkoly okolních jednotek, pošle na místo posily a zaène øídit vojenskou akci. Pokud s danou situací nechce nic dìlat (je to napø. jen zbloudilá nepøátelská jednotka), pak poté, co jednotka <b>A</b> dokonèí svùj &bdquo;soukromý&ldquo; útok, vrátí se k pùvodní èinnosti, kterou má v nadøazené frontì, tj. &bdquo;jdi nìkam a udìlej nìco&ldquo;.</p>

<p class="odkaz">
<a href="08b-jednotky.html"><img class="sipka" src="../cast-predchozi.png" alt="Pøedchozí èást" /></a>
<a href="08b-jednotky.html#zpravy">Zprávy</a>
</a>
</p>

</body>
</html>
